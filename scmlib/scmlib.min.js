var Scm=Scm||{};Scm.Utils=Scm.Utils||{};Scm.Utils.constructInheritance=function(d,c){var e=function(){};e.prototype=c.prototype;d.prototype=new e()};Scm.Utils.getValidObject=function(b,c){var a=c;if(typeof(b)!="undefined"){for(key in c){a[key]=((!b.hasOwnProperty(key))?(c[key]):(b[key]))}}return a};Scm.Utils.createDomElement=function(g,h,b,c,i,a,f){var d=document.createElement(g),e;f=f||true;e=((f)?("block"):("none"));d.setAttribute("id",b);d.setAttribute("width",c);d.setAttribute("height",i);d.setAttribute("style",a+" display: "+e+";");document.getElementById(h).appendChild(d)};Scm.Utils.DrawableParser=function(a){this.expression=a;this.regex="^WHERE ";this.regex+="(";this.regex+="(";this.regex+="(type|x|y|alpha|color) ";this.regex+="(==|<|<=|>|>=|!=) {VALUE}";this.regex+=")";this.regex+="( && | \\|\\| |)";this.regex+=")";this.regex+="{1,}$";this.tokens=[];this.isParsable=false;this.values={type:"circle|pixel|rect|text|img",x:"[-+]?[0-9]*.?[0-9]+([eE][-+]?[0-9]+)?",y:"[-+]?[0-9]*.?[0-9]+([eE][-+]?[0-9]+)?",alpha:"(0.([0-9]*))|0|1",color:"'#(?:[0-9a-fA-F]{3}){1,2}'"};this.isParsable=this.validate();this.getTokens()};Scm.Utils.DrawableParser.prototype.validate=function(){var b=this.expression.split(" ")[1],a="";if(typeof(this.values[b])!="undefined"){this.regex=this.regex.replace("{VALUE}","("+this.values[b]+")");a=this.expression.match(this.regex);if(!a){console.error("Scm : You have an error in your expression syntax. Check the documentation.");return false}return true}else{console.error("Scm : Undefined reference to parameter '"+b+"' in expression : '"+expression+"'")}return false};Scm.Utils.DrawableParser.prototype.getTokens=function(){if(this.isParsable){var a=this.expression.match(this.regex);if(a.length>=4&&this.tokens.length==0){var b=a[0].split(" ");b.splice(0,1);this.tokens=b}}return this.tokens};var GLOBAL_UPDATE_INTERVAL=10,GLOBAL_SCM_WIDTH=0,GLOBAL_SCM_HEIGHT=0;Scm.Core=function(b,c){if((this.node=document.getElementById(b))){var a="position: absolute;";Scm.Utils.createDomElement("div",b,"scmContent",this.node.clientWidth,this.node.clientHeight,a);a+=" display: block;";Scm.Utils.createDomElement("div","scmContent","a",this.node.clientWidth,this.node.clientHeight,a);Scm.Utils.createDomElement("div","scmContent","b",this.node.clientWidth,this.node.clientHeight,a,false);this.width=this.node.clientWidth;this.height=this.node.clientHeight;this.layers=[];this.displayedBuffer="a";this.hiddenBuffer="b";GLOBAL_UPDATE_INTERVAL=c||10;GLOBAL_SCM_WIDTH=this.width;GLOBAL_SCM_HEIGHT=this.height;if(!("bind" in Function.prototype)){Function.prototype.bind=function(d){var f=this;var e=Array.prototype.slice.call(arguments,1);return function(){return f.apply(d,e.length===0?arguments:arguments.length===0?e:e.concat(Array.prototype.slice.call(arguments,0)))}}}window.setInterval(this.update.bind(this),GLOBAL_UPDATE_INTERVAL)}else{console.error("SCM : #"+b+" doesn't exist !")}};Scm.Core.prototype.push=function(){var b,e,a,d;if(arguments.length==0){console.error("Scm : push needs at least 1 argument.")}else{for(var c=0;c!=arguments.length;c++){e=arguments[c];a=((this.layers.length>0)?(this.layers.length+1):(c+1));arguments[c].htmlName+=a;arguments[c].elementNumber=a;d="z-index: "+a+"; position: absolute;";Scm.Utils.createDomElement("canvas","a","scmLayer"+a+"a",this.width,this.height,d);Scm.Utils.createDomElement("canvas","b","scmLayer"+a+"b",this.width,this.height,d,false);this.layers.push(e)}}};Scm.Core.prototype.update=function(){for(var a=0;a!=this.layers.length;a++){if(!this.layers[a].locked){this.layers[a].drawAll(this.hiddenBuffer)}}document.getElementById(this.hiddenBuffer).style.display="block";document.getElementById(this.displayedBuffer).style.display="none";for(var a=0;a!=this.layers.length;a++){if(typeof(this.layers[a])!="undefined"&&!this.layers[a].locked){this.layers[a].clear(this.displayedBuffer)}}this.hiddenBuffer=((this.hiddenBuffer=="a")?("b"):("a"));this.displayedBuffer=((this.hiddenBuffer=="a")?("b"):("a"));Scm.Event.fire("coreUpdate")};Scm.Core.prototype.moveLayer=function(b,c){c=((c=="top")?(this.layers.length-1):(c));c=((c=="bottom")?(0):(c));if(c>=0&&c<this.layers.length){this.layers.splice(this.layers.indexOf(b),1);this.layers.splice(c,0,b);for(var a=0;a!=this.layers.length;a++){document.getElementById(this.layers[a].htmlName+this.displayedBuffer).setAttribute("style","z-index: "+a+"; position: absolute;");document.getElementById(this.layers[a].htmlName+this.hiddenBuffer).setAttribute("style","z-index: "+a+"; position: absolute;");this.layers[a].elementNumber=a}}else{console.error("Scm : undefined reference to pos "+c)}};Scm.Layer=function(a){this.htmlName="scmLayer";this.elementNumber;this.currentBuffer=null;this.locked=a||false;this.objects=[];this.textFont="sans-serif";this.textSize=10};Scm.Layer.prototype.getHtmlElement=function(){return document.getElementById(this.htmlName+this.currentBuffer)};Scm.Layer.prototype.getContext=function(a){return this.getHtmlElement().getContext(a)};Scm.Layer.prototype.setBackgroundColor=function(e){var g=document.getElementById(this.htmlName+"a").getContext("2d"),f=document.getElementById(this.htmlName+"b").getContext("2d"),c=g.canvas.width,d=g.canvas.height,a=f.canvas.width,b=f.canvas.height;g.fillStyle=e;f.fillStyle=e;g.fillRect(0,0,c,d);f.fillRect(0,0,a,b);this.locked=true};Scm.Layer.prototype.setBackgroundImg=function(c){var a=new Image(),b=this.htmlName;a.onload=function(){document.getElementById(b+"a").getContext("2d").drawImage(a,0,0);document.getElementById(b+"b").getContext("2d").drawImage(a,0,0)};a.src=c;this.locked=true};Scm.Layer.prototype.setParallaxScrolling=function(){var h={left:{property:"x",variation:-1},up:{property:"y",variation:-1},right:{property:"x",variation:1},down:{property:"y",variation:1},};if(arguments.length<4){console.error("Scm : setParallaxScrolling needs at least 3 arguments.")}else{if(typeof(h[arguments[0]])=="undefined"){console.error("Scm : setParallaxScrolling : Undefined reference to this direction")}else{var g=0,j=h[arguments[0]].property,d=arguments[1]*h[arguments[0]].variation,a=GLOBAL_SCM_WIDTH*h[arguments[0]].variation,k=GLOBAL_SCM_HEIGHT*h[arguments[0]].variation,c=0,b=new Date();for(var e=2;e!=arguments.length;e++){var f;if(arguments[0]=="left"||arguments[0]=="right"){f=new Scm.Image(arguments[e],(e-2)*-a,0);c=a}else{f=new Scm.Image(arguments[e],0,(e-2)*-k);c=k}f.createCustomEffect(j,d,c,null,"PSDone"+b.getTime());this.draw(f);g++}Scm.Event.on("PSDone"+b.getTime(),function(i){if(i.currentEffect.property=="y"){i.y=(g-1)*-k}else{if(i.currentEffect.property=="x"){i.x=(g-1)*-a}}i.createCustomEffect(j,d,c,null,"PSDone"+b.getTime())})}}};Scm.Layer.prototype.setGlobalAlpha=function(b){var a=this.getContext("2d");a.globalAlpha=b;this.update(a)};Scm.Layer.prototype.exist=function(a){for(var b=0;b!=this.objects.length;b++){if(this.objects[b]==a){return true}}return false};Scm.Layer.prototype.getAllObjects=function(filter,objects,justOne){justOne=justOne||false;objects=objects||this.objects;if(!filter){if(justOne){return objects[0]}return objects}var parser=new Scm.Utils.DrawableParser(filter),tokens=parser.getTokens(),ret=[],evalStr,next=false,idx=3;for(var j=0;j!=objects.length;j++){evalStr="";for(var i=0;i!=tokens.length;i++){if(next){evalStr+=" '"+objects[j][tokens[i]]+"'";next=false}else{if(i%idx==0){if(tokens[i]!="&&"&&tokens[i]!="||"){evalStr+=" '"+objects[j][tokens[i]]+"'"}else{evalStr+=" "+tokens[i];next=true;idx+=1}}else{evalStr+=" "+tokens[i]}}}if(eval(evalStr)){if(!justOne){ret.push(objects[j])}else{return objects[j]}}}return ret};Scm.Layer.prototype.getOneObject=function(a,b,c){return this.getAllObjects(a,b,true)};Scm.Layer.prototype.draw=function(){if(arguments.length==0){console.error("Scm : You should pass one or more drawable object for the method draw.")}for(var a=0;a<arguments.length;++a){if(!this.exist(arguments[a])){this.objects.push(arguments[a])}}};Scm.Layer.prototype.erase=function(a){var c=false;for(var b=0;b!=this.objects.length;b++){if(this.objects[b]==a){console.log(this.objects.slice(b,1));this.objects=this.objects.slice(b,1);c=true}}if(!c){console.error("Scm : Undefined reference to object.")}};Scm.Layer.prototype.drawAll=function(b){var a=document.getElementById(this.htmlName+b).getContext("2d"),c;for(var d=0;d!=this.objects.length;d++){c=this.objects[d];if(c.alpha>0||c.currentEffect.property=="alpha"){a.save();a.globalAlpha=c.alpha;if(c.currentEffect.duration-GLOBAL_UPDATE_INTERVAL>=0){c[c.currentEffect.property]+=c.currentEffect.variation;if((c.currentEffect.variation<0&&c.currentEffect.limit>c[c.currentEffect.property])||(c.currentEffect.variation>=0&&c[c.currentEffect.property]>c.currentEffect.limit)){c[c.currentEffect.property]=c.currentEffect.limit}c.currentEffect.duration=c.currentEffect.duration-GLOBAL_UPDATE_INTERVAL;if(c.currentEffect.duration==0){Scm.Event.fire(c.currentEffect.fireEventName,c);if(typeof(c.currentEffect.callback)!="undefined"&&c.currentEffect.callback!=null){(c.currentEffect.callback)(c)}}}if(c.color){a.fillStyle=c.color}c.draw(a);a.restore()}}};Scm.Layer.prototype.clear=function(a){ctx=document.getElementById(this.htmlName+a).getContext("2d"),width=ctx.canvas.width,height=ctx.canvas.height;ctx.clearRect(0,0,width,height)};Scm.Layer.prototype.getTextConfig=function(){return{font:this.textFont,size:this.textSize}};Scm.Layer.prototype.setTextConfig=function(a,b){this.textFont=a;this.textSize=b;this.getContext("2d").font=b+"px "+a};Scm.Layer.prototype.lock=function(){this.locked=true};Scm.Layer.prototype.unlock=function(){this.locked=false};Scm.Event=Scm.Event||{};Scm.Event={ref:{"37":{type:"left_arrow",callback:null},"38":{type:"up_arrow",callback:null},"39":{type:"right_arrow",callback:null},"40":{type:"down_arrow",callback:null}},scmNode:null};Scm.Event.init=function(b){for(var a=65;a<=90;a++){Scm.Event.ref[String(a)]={type:String.fromCharCode(a+32),callback:null}}document.onkeydown=function(c){var c=window.event||c;if(typeof(Scm.Event.ref[c.keyCode])!="undefined"&&Scm.Event.ref[c.keyCode].callback){(Scm.Event.ref[c.keyCode].callback)()}};Scm.Event.scmNode=b};Scm.Event.on=function(a,d){var c=false;for(var b in this.ref){if(Scm.Event.ref[b].type==a){Scm.Event.ref[b].callback=d;c=true}}if(!c){a=((a=="click")?("mouseup"):(a));document.getElementById(Scm.Event.scmNode).addEventListener(a,function(g){var f={x:0,y:0};if(typeof(g.offsetX)!="undefined"&&typeof(g.offsetY)!="undefined"){f.x=g.offsetX+1;f.y=g.offsetY+1}else{if(typeof(g.layerX)!="undefined"&&typeof(g.layerY)!="undefined"){f.x=g.layerX;f.y=g.layerY}else{f=g.detail}}d(f)},true)}return Scm.Event};Scm.Event.fire=function(a,c){var b=document.createEvent("CustomEvent");b.initCustomEvent(a,true,true,c);document.getElementById(Scm.Event.scmNode).dispatchEvent(b)};Scm.Event.init("scmContent");var constructEvent=false;var Drawable=function(a,d,b,c){this.x=a;this.y=d;this.color=b;this.alpha=((typeof(c)!="undefined")?(c):(1));this.currentEffect={duration:0,property:null,variation:0,limit:0,fireEventName:null,callback:null};if(!constructEvent){Scm.Event.on("effectDone",function(f){this.currentEffect={duration:0,property:null,variation:0,limit:0,fireEventName:null,callback:null}});constructEvent=true}};Drawable.prototype.setPos=function(a,b){this.x=a;this.y=b};Drawable.prototype.setColor=function(a){this.color=a};Drawable.prototype.setAlpha=function(a){this.alpha=a};Drawable.prototype.fadeIn=function(a,b){a=a||GLOBAL_UPDATE_INTERVAL;if(a<GLOBAL_UPDATE_INTERVAL){console.error("SCM : the duration of the fadeIn event is lower than the Scm.Core Update Interval ("+GLOBAL_UPDATE_INTERVAL+" ms)")}this.currentEffect={duration:a,property:"alpha",variation:((1-this.alpha)/(a/GLOBAL_UPDATE_INTERVAL)),limit:1,fireEventName:"effectDone",callback:b}};Drawable.prototype.fadeOut=function(a,b){a=a||GLOBAL_UPDATE_INTERVAL;if(a<GLOBAL_UPDATE_INTERVAL){console.error("SCM : the duration of the fadeOut event is lower than the Scm.Core Update Interval ("+GLOBAL_UPDATE_INTERVAL+" ms)")}this.currentEffect={duration:a,property:"alpha",variation:-((this.alpha-0)/(a/GLOBAL_UPDATE_INTERVAL)),limit:0,fireEventName:"effectDone",callback:b}};Drawable.prototype.createCustomEffect=function(e,d,g,h,c){var b=Math.abs(g-this[e]),a=Math.abs(g-(this[e]+d)),f;c=c||"effectDone";if(a>=b){console.error("Scm : invalid customEffect (never ends)")}else{if(g<this[e]){f=Math.abs((this[e]-g)/d)*GLOBAL_UPDATE_INTERVAL}else{f=Math.abs((g-this[e])/d)*GLOBAL_UPDATE_INTERVAL}if(f%GLOBAL_UPDATE_INTERVAL!=0){f=Math.ceil((f/GLOBAL_UPDATE_INTERVAL))*GLOBAL_UPDATE_INTERVAL}this.currentEffect={duration:f,property:e,variation:d,limit:g,fireEventName:c,callback:h}}};Drawable.prototype.hide=function(){this.alpha=0};Drawable.prototype.show=function(){this.alpha=1};Drawable.prototype.draw=function(a){console.error("SCM : Error ! You should implement a draw method in your own object.")};Scm.Pixel=function(a,d,b,c){Drawable.call(this,a,d,b,c)};Scm.Utils.constructInheritance(Scm.Pixel,Drawable);Scm.Pixel.prototype.draw=function(a){a.fillRect(this.x,this.y,1,1)};Scm.Rect=function(b,f,d,a,c,e){Drawable.call(this,b,f,c,e);this.width=d;this.height=a};Scm.Utils.constructInheritance(Scm.Rect,Drawable);Scm.Rect.prototype.setSize=function(b,a){this.width=b;this.height=a};Scm.Rect.prototype.draw=function(a){a.fillRect(this.x,this.y,this.width,this.height)};Scm.Circle=function(b,e,a,c,d){Drawable.call(this,b,e,c,d);this.radius=a;this.diameter=a*2};Scm.Utils.constructInheritance(Scm.Circle,Drawable);Scm.Circle.prototype.draw=function(a){a.beginPath();a.arc(this.x,this.y,this.radius,0,Math.PI*2,true);a.closePath();a.fill()};Scm.Text=function(d,a,e,b,c){b=((typeof(b)!="undefined")?(b):("#000000"));Drawable.call(this,a,e,b,c);this.str=d};Scm.Utils.constructInheritance(Scm.Text,Drawable);Scm.Text.prototype.draw=function(a){a.fillText(this.str,this.x,this.y)};Scm.Image=function(c,a,d,b){Drawable.call(this,a,d,null,b);this.src=c};Scm.Utils.constructInheritance(Scm.Image,Drawable);Scm.Image.prototype.setSrc=function(a){this.src=a};Scm.Image.prototype.draw=function(b){var c=new Image(),a=this.x,d=this.y;c.onload=function(){b.drawImage(c,a,d)};c.src=this.src};
/*! Simple Canvas Manager 0.4.0 | build 00041 | Wed Oct 24 2012 */