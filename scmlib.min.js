/*! Simple Canvas Manager v0.1.2 | http://scm-library.olympe.in */
var Scm=Scm||{};Scm.Utils=Scm.Utils||{};Scm.Utils.constructInheritance=function(d,c){var e=function(){};e.prototype=c.prototype;d.prototype=new e()};Scm.Utils.getValidObject=function(b,c){var a=c;if(typeof(b)!="undefined"){for(key in c){a[key]=((!b.hasOwnProperty(key))?(c[key]):(b[key]))}}return a};Scm.Utils.extend=function(a,b){Scm.Utils.constructInheritance(a,Scm.Circle)};var Scm=Scm||{};var GLOBAL_UPDATE_INTERVAL=10;Scm.Core=function(a,b){if((this.node=document.getElementById(a))){var c=document.createElement("div");c.setAttribute("id","scmContent");c.setAttribute("width",this.node.clientWidth);c.setAttribute("height",this.node.clientHeight);c.setAttribute("style","position: absolute;");this.node.appendChild(c);this.width=this.node.clientWidth;this.height=this.node.clientHeight;this.content=document.getElementById("scmContent");this.layers=[];GLOBAL_UPDATE_INTERVAL=b||10;if(!("bind" in Function.prototype)){Function.prototype.bind=function(d){var f=this;var e=Array.prototype.slice.call(arguments,1);return function(){return f.apply(d,e.length===0?arguments:arguments.length===0?e:e.concat(Array.prototype.slice.call(arguments,0)))}}}window.setInterval(this.update.bind(this),GLOBAL_UPDATE_INTERVAL)}else{console.error("SCM : #"+a+" doesn't exist !")}};Scm.Core.prototype.push=function(b){var a=document.createElement("canvas");a.setAttribute("id","scm"+b.name.charAt(0).toUpperCase()+b.name.slice(1));a.setAttribute("width",this.width);a.setAttribute("height",this.height);a.setAttribute("style","z-index: "+b.zindex+"; position: absolute;");this.content.appendChild(a);this.layers.push(b)};Scm.Core.prototype.getLayer=function(a){for(var b=0;b!=this.layers.length;b++){if(this.layers[b].name==a){return this.layers[b]}}console.error("Simple Canvas Manager : undefined reference to "+a+" layer !")};Scm.Core.prototype.update=function(){for(var a=0;a!=this.layers.length;a++){if(typeof(this.layers[a])!="undefined"&&!this.layers[a].locked){this.layers[a].clear()}}for(var a=0;a!=this.layers.length;a++){this.layers[a].drawAll()}Scm.Event.fire("coreUpdate")};var Scm=Scm||{};Scm.Layer=function(b,c,a){this.name=b;this.zindex=c;this.htmlName="scm"+b.charAt(0).toUpperCase()+b.slice(1);this.locked=a||false;this.objects=[];this.textFont="sans-serif";this.textSize=10};Scm.Layer.prototype.getHtmlElement=function(){return document.getElementById(this.htmlName)};Scm.Layer.prototype.getContext=function(a){return this.getHtmlElement().getContext(a)};Scm.Layer.prototype.setBackgroundColor=function(c){var b=this.getContext("2d"),d=b.canvas.clientWidth,a=b.canvas.clientHeight;b.fillStyle=c;b.fillRect(0,0,d,a);this.locked=true};Scm.Layer.prototype.setBackgroundImg=function(c){var a=this.getContext("2d"),b=new Image();b.onload=function(){a.drawImage(b,0,0)};b.src=c;this.locked=true};Scm.Layer.prototype.setGlobalAlpha=function(b){var a=this.getContext("2d");a.globalAlpha=b;this.update(a)};Scm.Layer.prototype.exist=function(a){for(var b=0;b!=this.objects.length;b++){if(this.objects[b]==a){return true}}return false};Scm.Layer.prototype.getAllObjects=function(a){return this.objects};Scm.Layer.prototype.draw=function(){if(arguments.length==0){console.error("Scm : You should pass one or more drawable object for the method draw.")}for(var a=0;a<arguments.length;++a){if(!this.exist(arguments[a])){this.objects.push(arguments[a])}}};Scm.Layer.prototype.erase=function(a){var c=false;for(var b=0;b!=this.objects.length;b++){if(this.objects[b]==a){console.log(this.objects.slice(b,1));this.objects=this.objects.slice(b,1);c=true}}if(!c){console.error("Scm : Undefined reference to object.")}};Scm.Layer.prototype.drawAll=function(){var a=this.getContext("2d"),b;for(var c=0;c!=this.objects.length;c++){b=this.objects[c];if(b.alpha>0||b.currentEffect.property=="alpha"){a.save();a.globalAlpha=b.alpha;if(b.currentEffect.duration-GLOBAL_UPDATE_INTERVAL>=0){b[b.currentEffect.property]+=b.currentEffect.variation;if((b.currentEffect.variation<0&&b.currentEffect.limit>b[b.currentEffect.property])||(b.currentEffect.variation>=0&&b[b.currentEffect.property]>b.currentEffect.limit)){b[b.currentEffect.property]=b.currentEffect.limit}b.currentEffect.duration=b.currentEffect.duration-GLOBAL_UPDATE_INTERVAL;if(b.currentEffect.duration==0){Scm.Event.fire("effectDone")}}if(b.color){a.fillStyle=b.color}b.draw(a);a.restore()}}};Scm.Layer.prototype.clear=function(){var b=this.getContext("2d"),c=b.canvas.clientWidth,a=b.canvas.clientHeight;b.clearRect(0,0,c,a)};Scm.Layer.prototype.getTextConfig=function(){return{font:this.textFont,size:this.textSize}};Scm.Layer.prototype.setTextConfig=function(a,b){this.textFont=a;this.textSize=b;this.getContext("2d").font=b+"px "+a};Scm.Layer.prototype.lock=function(){this.locked=true};Scm.Layer.prototype.unlock=function(){this.locked=false};var Scm=Scm||{};Scm.Event=Scm.Event||{};Scm.Event={ref:{"37":{type:"left_arrow",callback:null},"38":{type:"up_arrow",callback:null},"39":{type:"right_arrow",callback:null},"40":{type:"down_arrow",callback:null}},scmNode:null};Scm.Event.init=function(b){for(var a=65;a<=90;a++){Scm.Event.ref[String(a)]={type:String.fromCharCode(a+32),callback:null}}document.onkeydown=function(c){var c=window.event||c;if(typeof(Scm.Event.ref[c.keyCode])!="undefined"&&Scm.Event.ref[c.keyCode].callback){(Scm.Event.ref[c.keyCode].callback)()}};Scm.Event.scmNode=b};Scm.Event.on=function(a,d){var c=false;for(var b in this.ref){if(Scm.Event.ref[b].type==a){Scm.Event.ref[b].callback=d;c=true}}if(!c){document.getElementById(Scm.Event.scmNode).addEventListener(a,function(g){var f={x:0,y:0};if(typeof(g.offsetX)!="undefined"&&typeof(g.offsetY)!="undefined"){f.x=g.offsetX+1;f.y=g.offsetY+1}else{f=g}d(f)},true)}return Scm.Event};Scm.Event.fire=function(a){var b=document.createEvent("Events");b.initEvent(a,true,false);document.getElementById(Scm.Event.scmNode).dispatchEvent(b)};Scm.Event.init("scmContent");var Scm=Scm||{};var constructEvent=false;var Drawable=function(a,d,b,c){this.x=a;this.y=d;this.color=b;this.alpha=((typeof(c)!="undefined")?(c):(1));this.currentEffect={duration:0,property:null,variation:0,limit:0,};if(!constructEvent){Scm.Event.on("effectDone",function(f){this.currentEffect={duration:0,property:null,variation:0,limit:0,}});constructEvent=true}};Drawable.prototype.setPos=function(a,b){this.x=a;this.y=b};Drawable.prototype.setColor=function(a){this.color=a};Drawable.prototype.setAlpha=function(a){this.alpha=a};Drawable.prototype.fadeIn=function(a){a=a||GLOBAL_UPDATE_INTERVAL;if(a<GLOBAL_UPDATE_INTERVAL){console.error("SCM : the duration of the fadeIn event is lower than the Scm.Core Update Interval ("+GLOBAL_UPDATE_INTERVAL+" ms)")}this.currentEffect={duration:a,property:"alpha",variation:((1-this.alpha)/(a/GLOBAL_UPDATE_INTERVAL)),limit:1,}};Drawable.prototype.fadeOut=function(a){a=a||GLOBAL_UPDATE_INTERVAL;if(a<GLOBAL_UPDATE_INTERVAL){console.error("SCM : the duration of the fadeOut event is lower than the Scm.Core Update Interval ("+GLOBAL_UPDATE_INTERVAL+" ms)")}this.currentEffect={duration:a,property:"alpha",variation:-((this.alpha-0)/(a/GLOBAL_UPDATE_INTERVAL)),limit:0,}};Drawable.prototype.hide=function(){this.alpha=0};Drawable.prototype.show=function(){this.alpha=1};Drawable.prototype.draw=function(a){console.error("SCM : Error ! You should implement a draw method in your own object.")};Scm.Pixel=function(a,d,b,c){Drawable.call(this,a,d,b,c)};Scm.Utils.constructInheritance(Scm.Pixel,Drawable);Scm.Pixel.prototype.draw=function(a){a.fillRect(this.x,this.y,1,1)};Scm.Rect=function(b,f,d,a,c,e){Drawable.call(this,b,f,c,e);this.width=d;this.height=a};Scm.Utils.constructInheritance(Scm.Rect,Drawable);Scm.Rect.prototype.setSize=function(b,a){this.width=b;this.height=a};Scm.Rect.prototype.draw=function(a){a.fillRect(this.x,this.y,this.width,this.height)};Scm.Circle=function(b,e,a,c,d){Drawable.call(this,b,e,c,d);this.radius=a;this.diameter=a*2};Scm.Utils.constructInheritance(Scm.Circle,Drawable);Scm.Circle.prototype.draw=function(a){a.beginPath();a.arc(this.x,this.y,this.radius,0,Math.PI*2,true);a.closePath();a.fill()};Scm.Text=function(d,a,e,b,c){b=((typeof(b)!="undefined")?(b):("#000000"));Drawable.call(this,a,e,b,c);this.str=d};Scm.Utils.constructInheritance(Scm.Text,Drawable);Scm.Text.prototype.draw=function(a){a.fillText(this.str,this.x,this.y)};Scm.Image=function(c,a,d,b){Drawable.call(this,a,d,null,b);this.src=c};Scm.Utils.constructInheritance(Scm.Image,Drawable);Scm.Image.prototype.setSrc=function(a){this.src=a};Scm.Image.prototype.draw=function(b){var c=new Image(),a=this.x,d=this.y;c.onload=function(){b.drawImage(c,a,d)};c.src=this.src};